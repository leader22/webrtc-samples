!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(e,t,n){(function(r){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))}),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(5)(t);const{formatters:s}=e.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(4))},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,s="~";function i(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new a(n,r||e,i),c=s?s+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],o]:e._events[c].push(o):(e._events[c]=o,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function d(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),d.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},d.prototype.listeners=function(e){var t=s?s+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,a=new Array(i);r<i;r++)a[r]=n[r].fn;return a},d.prototype.listenerCount=function(e){var t=s?s+e:e,n=this._events[t];return n?n.fn?1:n.length:0},d.prototype.emit=function(e,t,n,r,i,a){var o=s?s+e:e;if(!this._events[o])return!1;var c,d,l=this._events[o],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,i),!0;case 6:return l.fn.call(l.context,t,n,r,i,a),!0}for(d=1,c=new Array(u-1);d<u;d++)c[d-1]=arguments[d];l.fn.apply(l.context,c)}else{var h,f=l.length;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),u){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,n);break;case 4:l[d].fn.call(l[d].context,t,n,r);break;default:if(!c)for(h=1,c=new Array(u-1);h<u;h++)c[h-1]=arguments[h];l[d].fn.apply(l[d].context,c)}}return!0},d.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},d.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},d.prototype.removeListener=function(e,t,n,r){var i=s?s+e:e;if(!this._events[i])return this;if(!t)return c(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||c(this,i);else{for(var o=0,d=[],l=a.length;o<l;o++)(a[o].fn!==t||r&&!a[o].once||n&&a[o].context!==n)&&d.push(a[o]);d.length?this._events[i]=1===d.length?d[0]:d:c(this,i)}return this},d.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&c(this,t)):(this._events=new i,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=s,d.EventEmitter=d,e.exports=d},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(1)),i=r(n(0)).default("based-dc"),a=["open","close","error","message","bufferedamountlow"];t.default=class extends s.default{constructor(e){super(),this._dc=e,this._closed=!1;for(const e of a)this._dc.addEventListener(e,this,!1)}get binaryType(){return this._dc.binaryType}set binaryType(e){this._dc.binaryType=e}get bufferedAmountLowThreshold(){return this._dc.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dc.bufferedAmountLowThreshold=e}get bufferedAmount(){return this._dc.bufferedAmount}get id(){return this._dc.id}get label(){return this._dc.label}get maxPacketLifeTime(){return"maxPacketLifeTime"in this._dc?this._dc.maxPacketLifeTime:this._dc.maxRetransmitTime}get maxRetransmits(){return this._dc.maxRetransmits}get negotiated(){return this._dc.negotiated}get ordered(){return this._dc.ordered}get priority(){return this._dc.priority}get protocol(){return this._dc.protocol}get readyState(){return this._dc.readyState}get closed(){return this._closed}close(){i("close()"),this._closed=!0;for(const e of a)this._dc.removeEventListener(e,this,!1);this._dc.close(),this.emit("close"),this.removeAllListeners()}send(e){if(i("send()",e),this._closed)throw new Error("Closed!");if("open"!==this._dc.readyState)throw new Error("Not opened!");this._dc.send(e)}handleEvent(e){if(!this._closed)switch(e.type){case"open":return this._handleOpen();case"close":return this._handleClose();case"error":return this._handleError(e);case"message":return this._handleMessage(e);case"bufferedamountlow":return this._handleBufferedAmountLow()}}_handleOpen(){this.emit("open")}_handleClose(){this.emit("close")}_handleError(e){this.emit("error",e.error)}_handleMessage(e){this.emit("message",e.data)}_handleBufferedAmountLow(){this.emit("bufferedamountlow")}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(0)),i=r(n(7)),a=s.default("simple-p2p");t.createTransport=function(e={}){Object.assign(e,{bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),a("create RTCPeerConnection w/",e);const t=new RTCPeerConnection(e);return new i.default(t)}},function(e,t){var n,r,s=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,d=[],l=!1,u=-1;function h(){l&&c&&(l=!1,c.length?d=c.concat(d):u=-1,d.length&&f())}function f(){if(!l){var e=o(h);l=!0;for(var t=d.length;t;){for(c=d,d=[];++u<t;)c&&c[u].run();u=-1,t=d.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function _(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new p(e,t)),1!==d.length||l||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=_,s.addListener=_,s.once=_,s.off=_,s.removeListener=_,s.removeAllListeners=_,s.emit=_,s.prependListener=_,s.prependOnceListener=_,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,n){e.exports=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let n;function a(...e){if(!a.enabled)return;const t=a,s=Number(new Date),i=s-(n||s);t.diff=i,t.prev=n,t.curr=s,n=s,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,s)=>{if("%%"===n)return n;o++;const i=r.formatters[s];if("function"==typeof i){const r=e[o];n=i.call(t,r),e.splice(o,1),o--}return n}),r.formatArgs.call(t,e),(t.log||r.log).apply(t,e)}return a.namespace=e,a.enabled=r.enabled(e),a.useColors=r.useColors(),a.color=t(e),a.destroy=s,a.extend=i,"function"==typeof r.init&&r.init(a),r.instances.push(a),a}function s(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function i(e,t){const n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function a(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(a),...r.skips.map(a).map(e=>"-"+e)].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),s=n.length;for(t=0;t<s;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(6),Object.keys(e).forEach(t=>{r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t){var n=1e3,r=60*n,s=60*r,i=24*s,a=7*i,o=365.25*i;function c(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}e.exports=function(e,t){t=t||{};var d=typeof e;if("string"===d&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var c=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*a;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*s;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===d&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return c(e,t,i,"day");if(t>=s)return c(e,t,s,"hour");if(t>=r)return c(e,t,r,"minute");if(t>=n)return c(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=s)return Math.round(e/s)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(0)),i=r(n(1)),a=n(8),o=r(n(11)),c=r(n(14)),d=s.default("simple-p2p:transport");t.default=class extends i.default{constructor(e){super(),this._closed=!1,this._connectionState="new",this._pc=e,this._pc.addEventListener("icecandidate",this,!1),this._pc.addEventListener("iceconnectionstatechange",this,!1),this._pc.addEventListener("connectionstatechange",this,!1),this._signaling=a.promised(e.createDataChannel("signaling",{negotiated:!0,id:0})),this._signaling.on("open",()=>this.emit("open")),this._signaling.on("close",()=>d("signaling close")),this._signaling.on("error",e=>{d("signaling error",e),this.emit("error",e)}),this._mediaHandler=new o.default(this._pc,this._signaling),this._dataHandler=new c.default(this._pc,this._signaling)}get closed(){return this._closed}get connectionState(){return this._connectionState}get mediaHandler(){return this._mediaHandler}get dataHandler(){return this._dataHandler}close(){d("close()"),this._closed=!0,this._updateConnectionState("closed"),this._mediaHandler._transportClose(),this._dataHandler._transportClose(),this._pc.close(),this._pc.removeEventListener("icecandidate",this,!1),this._pc.removeEventListener("iceconnectionstatechange",this,!1),this._pc.removeEventListener("connectionstatechange",this,!1),this.emit("close")}handleEvent(e){switch(e.type){case"icecandidate":return this._handleCandidateEvent(e);case"iceconnectionstatechange":return this._handleIceConnectionStateChangeEvent();case"connectionstatechange":return this._handleConnectionStateChangeEvent()}}async startNegotiation(e=!1){if(d("startNegotiation() iceRestart ?",e),this._closed)throw new Error("Transport closed!");if(await this._pc.createOffer({iceRestart:e}).then(e=>this._pc.setLocalDescription(e)),null===this._pc.localDescription)throw new Error("Can't generate offer SDP!");d("emit offer SDP"),d(this._pc.localDescription.sdp),this.emit("negotiation",{type:"offer",data:this._pc.localDescription})}async handleNegotiation(e){if(d("handleNegotiation()"),this._closed)d("transport already closed, ignore");else switch(e.type){case"candidate":return await this._handleCandidate(e.data);case"offer":return await this._handleOffer(e.data);case"answer":return await this._handleAnswer(e.data);default:d("Undefined payload, discard",e)}}async restartIce(){d("restartIce()"),await this.startNegotiation(!0)}async getStats(){if(d("getStats()"),this._closed)throw new Error("Transport closed!");return await this._pc.getStats()}async _handleOffer(e){if(d("handle offer SDP"),"offer"!==e.type)throw new Error("Received SDP is not an offer!");if(d(e.sdp),await Promise.all([this._pc.setRemoteDescription(e),this._pc.createAnswer().then(e=>this._pc.setLocalDescription(e))]),null===this._pc.localDescription)throw new Error("Can't generate answer SDP!");d("emit answer SDP"),d(this._pc.localDescription.sdp),this.emit("negotiation",{type:"answer",data:this._pc.localDescription})}async _handleAnswer(e){if(d("handle answer SDP"),"answer"!==e.type)throw new Error("Received SDP is not an answer!");d(e.sdp),await this._pc.setRemoteDescription(e)}async _handleCandidate(e){d("handle candidate"),d(e.candidate),await this._pc.addIceCandidate(e)}_handleCandidateEvent(e){null!==e.candidate&&""!==e.candidate.candidate&&this.emit("negotiation",{type:"candidate",data:e.candidate})}_handleIceConnectionStateChangeEvent(){d("iceConnectionState",this._pc.iceConnectionState);const e={new:null,checking:"connecting",connected:"connected",completed:"connected",disconnected:"disconnected",failed:"failed",closed:"closed"}[this._pc.iceConnectionState]||this._connectionState;this._updateConnectionState(e)}_handleConnectionStateChangeEvent(){d("connectionState",this._pc.connectionState);const e={new:null,connecting:null,connected:null,disconnected:"disconnected",failed:"failed",closed:"closed"}[this._pc.connectionState]||this._connectionState;this._updateConnectionState(e)}_updateConnectionState(e){this._connectionState!==e&&(this._connectionState=e,this.emit("connectionStateChange",this._connectionState))}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(2)),i=r(n(9)),a=r(n(10)),o=r(n(0)).default("enhanced-dc");t.based=function(e){if(e instanceof RTCDataChannel==0)throw new Error("Missing datachannel instance!");return new s.default(e)},t.promised=function(e){if(e instanceof RTCDataChannel==0)throw new Error("Missing datachannel instance!");if(!e.ordered)throw new Error("The ordered property must be true!");return new i.default(e)},t.chunked=function(e){if(e instanceof RTCDataChannel==0)throw new Error("Missing datachannel instance!");if(!e.ordered)throw new Error("The ordered property must be true!");return"arraybuffer"!==e.binaryType&&(o(`change binaryType ${e.binaryType} -> arraybuffer`),e.binaryType="arraybuffer"),new a.default(e)}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(0)),i=r(n(2)),a=s.default("promised-dc"),o={REQUEST:0,SUCCESS_RESPONSE:1,ERROR_RESPONSE:2};t.default=class extends i.default{constructor(e){super(e),this._sentRequests=new Map}close(){a("close()");for(const e of this._sentRequests.values())e.close();this._sentRequests.clear(),super.close()}async send(e){if(a("send()",e),this._closed)throw new Error("Closed!");if("open"!==this._dc.readyState)throw new Error("Not opened!");const t=String(Math.random()).slice(2,6),n={type:o.REQUEST,id:t,data:e};let r;try{r=JSON.stringify(n)}catch(e){throw new Error("Can not convert to JSON!")}return this._dc.send(r),new Promise((e,r)=>{const s=1e3+500*this._sentRequests.size,i={timer:window.setTimeout(()=>{this._sentRequests.delete(n.id)&&r(new Error("Timeout!"))},s),resolve:t=>{this._sentRequests.delete(n.id)&&(window.clearTimeout(i.timer),e(t))},reject:e=>{this._sentRequests.delete(n.id)&&(window.clearTimeout(i.timer),r(e))},close:()=>{this._sentRequests.delete(n.id)&&(window.clearTimeout(i.timer),r(new Error("Closed!")))}};this._sentRequests.set(t,i)})}_handleMessage(e){const t=JSON.parse(e.data);switch(t.type){case o.REQUEST:return this._handleRequest(t);case o.SUCCESS_RESPONSE:case o.ERROR_RESPONSE:return this._handleResponse(t)}}_handleRequest(e){try{this.emit("message",e.data,t=>{let n;try{n=JSON.stringify({type:o.SUCCESS_RESPONSE,id:e.id,data:t})}catch(e){throw new Error("Can not convert to JSON!")}this._dc.send(n)},t=>{this._dc.send(JSON.stringify({type:o.ERROR_RESPONSE,id:e.id,err:t.toString()}))})}catch(t){this._dc.send(JSON.stringify({type:o.ERROR_RESPONSE,id:e.id,err:t.toString()}))}}_handleResponse(e){const t=this._sentRequests.get(e.id);if(t)return"err"in e?t.reject(new Error(e.err)):t.resolve(e.data);a("sent request not found...")}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(0)),i=r(n(2)),a=s.default("chunked-dc"),o=16e3,c={START:"START",END:"END"};t.default=class extends i.default{constructor(e){super(e),this._sending=!1,this._recving=!1,this._recvBuffer=[]}get sending(){return this._sending}get recving(){return this._recving}set binaryType(e){throw new Error("Can not change binaryType!")}get binaryType(){return this._dc.binaryType}close(){a("close()"),this._sending=!1,this._recving=!1,this._recvBuffer.length=0,super.close()}async send(e,t={}){if(a("send()",e,t),this._closed)throw new Error("Closed!");if("open"!==this._dc.readyState)throw new Error("Not opened!");if(this._sending)throw new Error("Can not send files in parallel!");if(e instanceof Blob==0)throw new Error("Argument is not an instance of File!");if(0===e.size)throw new Error("Empty file!");try{JSON.stringify(t)}catch(e){throw new Error("Can not convert to JSON!")}return a(`data has ${e.size}bytes`),new Promise((n,r)=>{const s=new FileReader;let i=0;const d=t=>{a(`read slice of idx ${t}`);const n=e.slice(i,t+o);s.readAsArrayBuffer(n)};s.onerror=e=>r(e),s.onabort=()=>r(new Error("Read file aborted!")),s.onload=()=>{const{result:o}=s;if(null===o||"string"==typeof o)return r(new Error("Invalid read result!"));a("send slice"),this._dc.send(o),(i+=o.byteLength)<e.size?d(i):(a("signal end sending"),this._dc.send(JSON.stringify({type:c.END,meta:t})),s.onerror=s.onabort=s.onload=null,this._sending=!1,n())},a("signal start sending"),this._sending=!0,this._dc.send(JSON.stringify({type:c.START})),d(0)})}_handleMessage(e){const{data:t}=e;if("string"==typeof t||t instanceof ArrayBuffer){if("string"==typeof t){const{type:e,meta:n}=JSON.parse(t);return e===c.START&&(a("start recving"),this._recving=!0),void(e===c.END&&(a("end recving"),this.emit("message",new Blob(this._recvBuffer),n),this._recving=!1,this._recvBuffer.length=0))}a("recv chunk"),this._recvBuffer.push(t)}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(0)),i=r(n(1)),a=r(n(12)),o=r(n(13)),c=s.default("simple-p2p:media-handler");t.default=class extends i.default{constructor(e,t){super(),this._closed=!1,this._stream=new MediaStream,this._senders=new Map,this._receivers=new Map,this._pc=e,this._signaling=t,this._signaling.on("message",async(e,t,n)=>{if(!this._closed)switch(e.type){case"media-negotiation":await this._handleMediaNegotiation(e,t,n);break;case"media-replace":await this._handleMediaReplace(e,t,n)}})}get closed(){return this._closed}_transportClose(){c("_transportClose()"),this._closed=!0}async sendTrack(e){if(c("sendTrack()"),this._closed)throw new Error("MediaHandler already closed!");if(!(e instanceof MediaStreamTrack))throw new Error("Missing MediaStreamTrack!");const t=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._stream]}),n=this._pc.getTransceivers().indexOf(t),r=await this._pc.createOffer();try{await this._startNegotiation(r,n)}catch(e){throw c("negotiation failed",e),t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),t.direction="inactive",new Error("Remote handler failed to receive track!")}const s=new a.default(e,n);return this._senders.set(n,s),this._handleSenderEvent(s),s}async _startNegotiation(e,t){if(c(`_startNegotiation() for tidx: ${t}`),await this._pc.setLocalDescription(e),null===this._pc.localDescription)throw new Error("Can't generate offer SDP!");c("send offer"),c(this._pc.localDescription.sdp);try{const e=await this._signaling.send({type:"media-negotiation",data:{offer:this._pc.localDescription,tidx:t}});c("recv answer"),c(e.sdp),await this._pc.setRemoteDescription(e)}catch(e){throw c("can not get answer back",e),e}}async _handleMediaNegotiation(e,t,n){const{offer:r,tidx:s}=e.data;c(`_handleMediaNegotiation() for tidx: ${s}`),c("handle offer SDP"),c(r.sdp);try{await Promise.all([this._pc.setRemoteDescription(r),this._pc.createAnswer().then(e=>this._pc.setLocalDescription(e))])}catch(e){return c("sRD failed",e),n(e)}if(null===this._pc.localDescription)return n(new Error("Can't generate answer SDP!"));const i=this._pc.getTransceivers()[s];if(!i)return n(new Error("Missing transceiver!"));if("recvonly"===i.currentDirection){const e=new o.default(i.receiver.track,s);this._receivers.set(s,e),this._handleReceiverEvent(e),this.emit("receiver",e)}if("inactive"===i.currentDirection){const e=this._receivers.get(s);if(!e)return n(new Error("Missing receiver!"));e._endedBySender()}c("emit answer SDP"),c(this._pc.localDescription.sdp),t(this._pc.localDescription)}_handleMediaReplace(e,t,n){const{tidx:r}=e.data;c(`_handleMediaReplace() for tidx: ${r}`);const s=this._receivers.get(r);if(!s)return n(new Error("Missing receiver!"));s._replacedBySender(),t()}_handleSenderEvent(e){e.on("@replace",async(e,t,n,r)=>{const s=this._pc.getTransceivers()[e];if(!s)return r(new Error("Missing transceiver!"));await Promise.all([s.sender.replaceTrack(t),this._signaling.send({type:"media-replace",data:{tidx:e}})]).then(n).catch(r)}),e.on("@end",async(e,t,n)=>{const r=this._pc.getTransceivers()[e];if(!r)return n(new Error("Missing transceiver!"));r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),r.direction="inactive";const s=await this._pc.createOffer();await this._startNegotiation(s,e).then(t).catch(n)}),e.on("@stats",async(e,t,n)=>{const r=this._pc.getTransceivers()[e];if(!r)return n(new Error("Missing transceiver!"));await r.sender.getStats().then(t).catch(n)})}_handleReceiverEvent(e){e.on("@stats",async(e,t,n)=>{const r=this._pc.getTransceivers()[e];if(!r)return n(new Error("Missing transceiver!"));await r.receiver.getStats().then(t).catch(n)})}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(0)),i=r(n(1)),a=s.default("simple-p2p:sender");t.default=class extends i.default{constructor(e,t){super(),this._ended=!1,this._track=e,this._tidx=t}get ended(){return this._ended}get track(){return this._track}async replace(e){if(a("replace()"),this._ended)throw new Error("Already ended sender!");if(!(e instanceof MediaStreamTrack))throw new Error("Missing MediaStreamTrack!");if(this._track===e)throw new Error("Do not need to replace the same track!");if(this._track.kind!==e.kind)throw new Error("Can not replace different kind of track!");await new Promise((t,n)=>{this.emit("@replace",this._tidx,e,t,n)}),this._track=e}async end(){if(a("end()"),this._ended)throw new Error("Already ended sender!");await new Promise((e,t)=>{this.emit("@end",this._tidx,e,t)}),this._ended=!0}async getStats(){if(a("getStats()"),this._ended)throw new Error("Already ended sender!");return await new Promise((e,t)=>{this.emit("@stats",this._tidx,e,t)})}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(0)),i=r(n(1)),a=s.default("simple-p2p:receiver");t.default=class extends i.default{constructor(e,t){super(),this._ended=!1,this._track=e,this._tidx=t}get ended(){return this._ended}get track(){return this._track}async getStats(){if(a("getStats()"),this._ended)throw new Error("Already ended receiver!");return await new Promise((e,t)=>{this.emit("@stats",this._tidx,e,t)})}_replacedBySender(){a("_replacedBySender()"),this.emit("replace")}_endedBySender(){a("_endedBySender()"),this._ended=!0,this.emit("ended")}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(n(0)),i=r(n(1)),a=s.default("simple-p2p:data-handler");t.default=class extends i.default{constructor(e,t){super(),this._closed=!1,this._dataChannelId=10,this._pc=e,this._signaling=t,this._signaling.on("message",async(e,t,n)=>{if(!this._closed)switch(e.type){case"data-channel":await this._handleDataChannel(e,t,n)}})}get closed(){return this._closed}_transportClose(){a("_transportClose()"),this._closed=!0}async createChannel(e="",t={}){if(a("createChannel()"),this._closed)throw new Error("DataHandler already closed!");Object.assign(t,{negotiated:!0,id:this._dataChannelId}),a(e,t);const n=this._pc.createDataChannel(e,t);this._dataChannelId++;try{await this._signaling.send({type:"data-channel",data:{label:e,dcInit:t}})}catch(e){throw a("remote#createDataChannel() failed",e),n.close(),new Error("Failed to create remote data channel!")}return n}async _handleDataChannel(e,t,n){const{label:r,dcInit:s}=e.data;let i;try{i=this._pc.createDataChannel(r,s),this._dataChannelId++}catch(e){return n(e)}this.emit("channel",i),t()}}},function(e,t,n){"use strict";n.r(t);var r=n(3);const s=location.pathname.split("/").filter(Boolean).pop(),i=localStorage.getItem("SIGNALING_SFX")+"+"+s,a=localStorage.getItem("SIGNALING_KEY");function o(e){const t=document.querySelectorAll(e);if(0===t.length)throw new Error(`${e} not found!`);return 1===t.length?t[0]:t}const{createChannel:c}=window.External;(async()=>{!function(e){const t=document.createElement("a");t.href=`https://github.com/leader22/webrtc-samples/blob/master/docs/${s}`,t.textContent="View source";const n=document.createTextNode(" | UA: "),r=document.createElement("span");r.textContent=e,document.body.append(document.createElement("hr")),document.body.append(t),document.body.append(n),document.body.append(r)}(navigator.userAgent);let e=null,t=null;o("#connect").onclick=async()=>{const n=await c(a,i),s=await n.fetchUsers();console.log(s);const d=1===s.length?"answer":"offer";"offer"===d&&console.log("Create and send offer..."),"answer"===d&&console.log("Wait for offer..."),e=window.tr=Object(r.createTransport)({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),n.on("@message",t=>e.handleNegotiation(t.data)),e.on("negotiation",e=>n.send(e)),e.on("connectionStateChange",e=>console.warn(e)),e.on("error",e=>console.error(e)),e.dataHandler.on("channel",e=>{t=e,console.log("got channel!",t),t.onmessage=e=>o("#message").textContent=e.data}),e.mediaHandler.on("receiver",e=>{const t=document.createElement("video");t.srcObject=new MediaStream([e.track]),t.play().catch(console.error),o("#media").appendChild(t)}),"offer"===d&&await e.startNegotiation(),e.once("open",async()=>{console.log("transport open!",e),o("#createdata").onclick=async()=>{t=await e.dataHandler.createChannel(),console.log("create DataChannel",t),t.onmessage=e=>o("#message").textContent=e.data},o("#senddata").onclick=()=>t.send(`Hello at ${Date.now()}`),o("#sendvideo").onclick=async()=>{const t=await navigator.mediaDevices.getUserMedia({video:!0}).then(e=>e.getVideoTracks()[0]),n=await e.mediaHandler.sendTrack(t);o("#repldisp").onclick=async()=>{const e=await navigator.mediaDevices.getDisplayMedia({video:!0}).then(e=>e.getVideoTracks()[0]);await n.replace(e)}},o("#sendaudio").onclick=async()=>{const t=await navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>e.getAudioTracks()[0]);await e.mediaHandler.sendTrack(t)},o("#senddisp").onclick=async()=>{const t=await navigator.mediaDevices.getDisplayMedia({video:!0}).then(e=>e.getVideoTracks()[0]);await e.mediaHandler.sendTrack(t)}})}})()}]);